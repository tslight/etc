#+TITLE: One Shell To Rule Them All!
#+PROPERTY: header-args :cache yes
#+PROPERTY: header-args :comments no
#+PROPERTY: header-args+ :mkdirp yes
#+PROPERTY: header-args+ :padline no
#+PROPERTY: header-args+ :results silent
#+PROPERTY: header-args+ :tangle-mode (identity #o644)
* ALIASES
#+name: aliases
#+begin_src shell :tangle ~/.bashrc
  alias cp='cp -i'
  alias d='docker'
  alias df='df -h'
  alias du='du -h'
  alias e='emacs -nw'
  alias ec='emacsclient -c -a "" -nw'
  alias g='git'
  alias grep='grep --color=always'
  alias h='history'
  alias j='jobs -l'
  alias k='kubectl'
  alias lc='tokei'
  alias ls='ls --color=always'
  alias l='ls -a'
  alias ll='ls -la'
  alias m="make"
  alias mkdir='mkdir -p'
  alias mv='mv -i'
  alias p='pwd'
  alias pg='pgrep -ail'
  alias ping4='ping -c 4'
  alias pingg='ping -c 4 google.com'
  alias rm='rm -i'
  alias se='sudoedit'
  alias t='tmux attach'
  alias up='uptime'
#+end_src
#+begin_src conf :noweb yes :tangle ~/.zshrc
  <<aliases>>
#+end_src
* BASH
** ENVIRONMENT
#+BEGIN_SRC sh :tangle ~/.bash_profile
  export ALTERNATE_EDITOR=""
  export BLOCK_SIZE=human-readable
  export EDITOR="emacsclient -c -nw"
  export HISTCONTROL=ignoreboth:erasedups
  export HISTFILESIZE=999999
  export HISTIGNORE="h:history:[bf]g:exit:^ll$:^lla$:^ls$"
  export HISTSIZE=999999
  export HISTTIMEFORMAT="%h %d %H:%M:%S "

  PATH="${HOME}/bin:${PATH}"
  PATH="${HOME}/.local/bin:${PATH}"
  export PATH

  MANPATH="${HOME}/.local/share/man:${MANPATH}"
  MANPATH="${HOME}/opt/share/man:${MANPATH}"
  export MANPATH

  umask 022
#+END_SRC
** COMPLETION
#+begin_src shell
  complete -cf sudo     # completion after sudo
  complete -cf man      # same, but for man
#+end_src
** PROMPT
#+BEGIN_SRC sh :tangle ~/.bashrc
  export RED="\\[\\e[1;31m\\]"
  export GRN="\\[\\e[1;32m\\]"
  export YEL="\\[\\e[1;33m\\]"
  export MAG="\\[\\e[1;35m\\]"
  export CYN="\\[\\e[1;36m\\]"
  export OFF="\\[\\e[0m\\]"

  export GIT_PS1_SHOWDIRTYSTATE=yes
  export GIT_PS1_SHOWSTASHSTATE=yes
  export GIT_PS1_SHOWUNTRACKEDFILES=true
  export GIT_PS1_SHOWUPSTREAM=yes

  if [ "$(id -u)" -eq 0 ]; then
      export PS1="${RED}\\u${YEL}@${RED}\\h${YEL}:${MAG}\\W \\n${YEL}\$? \$ ${OFF}"
  else
      export PS1="${GRN}\\u${YEL}@${GRN}\\h${YEL}:${MAG}\\W \\n${YEL}\$? \$ ${OFF}"
  fi
#+END_SRC
** OPTIONS
#+BEGIN_SRC sh :tangle ~/.bashrc
  shopt -s autocd       # cd without cd. who knew?
  shopt -s checkjobs    # don't exit if we still have jobs running
  shopt -s dirspell     # correct directory spelling
  shopt -s globstar     # pattern match ** in filename context
  shopt -s cdspell      # correct minor cd spelling errors
  shopt -s checkwinsize # update lines and columns when resizing
  shopt -s cmdhist      # save multi line cmds as one entry
  shopt -s dotglob      # show dotfiles when expanding
  shopt -s extglob      # enable extended pattern matching
  shopt -s histappend   # don't overwrite history file on exit
  shopt -s nocaseglob   # match filename case insensitively
  stty -ixon            # disable ctrl-s/q flow control
#+END_SRC
* INPUTRC
#+BEGIN_SRC sh :tangle ~/.inputrc
  set bell-style none
  set colored-completion-prefix on
  set colored-stats on
  set completion-ignore-case on
  set keyseq-timeout 1200
  set show-all-if-ambiguous on
  set show-all-if-unmodified on
  "\en": history-search-forward
  "\ep": history-search-backward
#+END_SRC
* ZSH
** AUTOLOAD
#+begin_src shell :tangle ~/.zshrc
  autoload -Uz compinit && compinit -u      # completion library
  autoload -Uz bashcompinit && bashcompinit # bash completions too please
  autoload -Uz colors && colors             # colour library
  # autoload -Uz promptinit && promptinit && prompt vcs
  # Alt-n & Alt-p to search history using current input
  autoload -Uz history-search-end
  zle -N history-beginning-search-backward-end history-search-end
  zle -N history-beginning-search-forward-end history-search-end
  bindkey '\ep' history-beginning-search-backward-end
  bindkey '\en' history-beginning-search-forward-end
#+end_src
** BINDINGS
#+begin_src shell :tangle ~/.zshrc
  bindkey '^[[Z' reverse-menu-complete # shift-tab cycles backwards
  bindkey \^U backward-kill-line # ctrl-u (whole-line by default)
#+end_src
** COMPLETION
#+begin_src shell :tangle ~/.zshrc
  zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' 'r:|[._-]=* r:|=*' 'l:|=* r:|=*' # case insensitivity
  zstyle ':completion:*' menu select # arrow select
  zstyle ':completion:*' rehash true # auto add new commands
  zstyle ':completion:*:*:kill:*:processes' list-colors '=(#b) #([0-9]#)*=0=01;32'
  zstyle ':completion:*:default' list-colors "${(@s.:.)LS_COLORS}"
  zstyle ':completion:*:kill:*' command 'ps -u $USER -o pid,user,%cpu,tty,cputime,cmd'
  zstyle ':completion:*:make::' tag-order targets variables # show targets before variables
  zstyle ':completion:*:make:*:targets' call-command true # make target completions
  zstyle ':completion:*:processes' command 'ps -au $USER'
  zstyle ':completion:*:processes-names' command 'ps -e -o comm='
#+end_src
** ENVIRONMENT
#+BEGIN_SRC sh :tangle ~/.zshenv
  export HISTFILE=$HOME/.zsh_history
  export HISTSIZE=100000
  export SAVEHIST=$HISTSIZE
  export EDITOR="emacsclient -nw -c"
  export ALTERNATE_EDITOR=""
  export PAGER=less
  export GTK_THEME=Emacs
  export BLOCK_SIZE=human-readable
  export DIRSTACKSIZE=12
  export KEYTIMEOUT=1
  WORDCHARS=${WORDCHARS/\-} # adds - to word delimiter
  WORDCHARS=${WORDCHARS/\.} # adds . to word delimiter
  WORDCHARS=${WORDCHARS/\/} # adds / to word delimiter
  WORDCHARS=${WORDCHARS/\\} # adds \ to word delimiter
  WORDCHARS=${WORDCHARS/\=} # adds = to word delimiter
  WORDCHARS=${WORDCHARS/\_} # adds _ to word delimiter
  export WORDCHARS

  # https://superuser.com/a/1054825
  typeset -U CDPATH cdpath
  cdpath=($HOME $HOME/src $cdpath)
  export CDPATH

  typeset -U PATH path
  path=($HOME/bin $HOME/.local/bin $path)
  export PATH

  umask 022
#+END_SRC
** OPTIONS
#+BEGIN_SRC sh :tangle ~/.zshrc
  setopt auto_name_dirs         # absolute name becomes dir
  setopt autocd                 # cd without typing cd. omg.
  setopt chaselinks             # follow links in cd.
  setopt complete_in_word       # complete unique matches
  setopt correct                # allow me to be slack
  setopt extended_glob          # set awesome to max
  setopt hist_expire_dups_first # trim duplicates from file first
  setopt hist_find_no_dups      # when searching don't find duplicates
  setopt hist_ignore_all_dups   # don't store duplicates
  setopt hist_ignore_space      # don't store cmds that start with a space
  setopt hist_no_store          # don't store history cmds
  setopt inc_append_history     # immediately write cmd after enter
  setopt longlistjobs           # display PID when suspending processes as well
  setopt list_ambiguous         # complete until it gets ambiguous
  setopt magic_equal_subst      # expand inside equals
  setopt nobeep                 # stop harassing me
  setopt nonomatch              # try to avoid the 'zsh: no matches found...'
  setopt prompt_subst           # param expansion, cmd substitution, &  math
  unsetopt flow_control         # stty ixon doesn't work, but this does.
  unsetopt completealiases      # supposedly allows aliases to be completed, but I turn it off because it breaks mine..
  ttyctl -f                     # avoid having to manually reset the terminal
#+END_SRC
** PROMPT
#+begin_src zsh :tangle ~/.zshrc
  prompt_vcs_setup() {
      zstyle ':vcs_info:*' enable git svn
      zstyle ':vcs_info:git:*' formats '%B%F{cyan}(%b)%f'
      autoload -Uz vcs_info
      precmd_vcs_info() { vcs_info; }
      precmd_functions+=( precmd_vcs_info )
      setopt prompt_subst
      local user_at_host="%B%F{green}%n%B%F{yellow}@%B%F{green}%m%b%f"
      local cwd="%B%F{yellow}:%F{magenta}%1~%b%f"
      local git_branch=\$vcs_info_msg_0_
      local exit_status="%B%(?.%F{yellow}âˆš.%F{red}%?)"
      local priv="%B%F{yellow}%#%b%f"
      PS1="${user_at_host}${cwd} ${git_branch}"$'\n'"${exit_status} ${priv} "
      PS2="> "
      prompt_opts=( cr percent )
  }

  prompt_vcs_setup "$@"
#+end_src
