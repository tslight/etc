#+TITLE: Still a WAY to go until the promised LAND!
#+PROPERTY: header-args :cache yes
#+PROPERTY: header-args+ :mkdirp yes
#+PROPERTY: header-args+ :padline no
#+PROPERTY: header-args+ :results silent
* FUZZEL
#+begin_src conf :tangle ~/.config/fuzzel/fuzzel.ini
  lines=20
  width=20
  horizontal-pad=8
  vertical-pad=8
  icons-enabled=false
  use-bold=true
  font=JetBrainsMono Nerd Font:size=13
  [colors]
  background=000000ff
  text=ffffffff
  match=ffffffff
  selection-match=ffffffff
  selection=662277ff
  selection-text=ffffffff
  border=662277ff
  [border]
  width=1
  radius=0
#+end_src
* NIRI
#+begin_src kdl :tangle ~/.config/niri/config.kdl
  input {
	  keyboard {
		  xkb {
			  layout "us"
		  }
		  numlock
	  }
	  touchpad {
		  tap
		  natural-scroll
	  }
  }

  output "eDP-1" {
	  background-color "#000"
	  backdrop-color "#203"
  }
  output "DP-1" {
	  focus-at-startup
	  background-color "#000"
	  backdrop-color "#203"
  }

  layout {
	  gaps 0
	  background-color "#000"
	  center-focused-column "never"
	  preset-column-widths {
		  proportion 0.33333
		  proportion 0.5
		  proportion 0.66667
		  proportion 0.99999
	  }
	  default-column-width { proportion 0.99999; }
	  focus-ring {
		  width 2
		  active-color "#B28"
		  inactive-color "#627"
	  }
	  border { off; }
	  shadow { off; }
  }

  spawn-at-startup "waybar"
  spawn-sh-at-startup "wlsunset -l 51.50 -L -0.12"
  spawn-sh-at-startup "swayidle -w timeout 120 'niri msg action power-off-monitors' timeout 600 'swaylock -c 000000' before-sleep 'swaylock -c 000000'"

  hotkey-overlay { skip-at-startup; }
  prefer-no-csd
  screenshot-path "~/Pictures/scrots/%Y-%m-%d.%H-%M-%S.png"
  animations { off; }

  window-rule {
	  match app-id=r#"firefox$"# title="^Picture-in-Picture$"
	  open-floating true
  }

  binds {
	  Mod+Slash { show-hotkey-overlay; }
	  Mod+E      hotkey-overlay-title="Open Editor" { spawn "nirirun" "emacs"; }
	  Mod+T      hotkey-overlay-title="Open Terminal" { spawn "nirirun" "foot" "-e" "tmux" "attach"; }
	  Mod+W      hotkey-overlay-title="Open Web Browser" { spawn "nirirun" "librewolf"; }
	  Mod+Space  hotkey-overlay-title="Launch Programs" { spawn "fuzzel"; }
	  Mod+Ctrl+Q hotkey-overlay-title="Lock Screen" { spawn "swaylock" "-c" "000000"; }
	  XF86AudioMute         allow-when-locked=true { spawn-sh "wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle"; }
	  XF86AudioLowerVolume  allow-when-locked=true { spawn-sh "wpctl set-volume @DEFAULT_AUDIO_SINK@ 0.1-"; }
	  XF86AudioRaiseVolume  allow-when-locked=true { spawn-sh "wpctl set-volume @DEFAULT_AUDIO_SINK@ 0.1+"; }
	  XF86AudioMicMute      allow-when-locked=true { spawn-sh "wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle"; }
	  XF86AudioPlay         allow-when-locked=true { spawn-sh "playerctl play-pause"; }
	  XF86AudioStop         allow-when-locked=true { spawn-sh "playerctl stop"; }
	  XF86AudioPrev         allow-when-locked=true { spawn-sh "playerctl previous"; }
	  XF86AudioNext         allow-when-locked=true { spawn-sh "playerctl next"; }
	  XF86MonBrightnessDown allow-when-locked=true { spawn "brightnessctl" "--class=backlight" "set" "10%-"; }
	  XF86MonBrightnessUp   allow-when-locked=true { spawn "brightnessctl" "--class=backlight" "set" "+10%"; }

	  Mod+O repeat=false { toggle-overview; }
	  Mod+Q repeat=false { close-window; }

	  Mod+H     { focus-column-left; }
	  Mod+J     { focus-window-down; }
	  Mod+K     { focus-window-up; }
	  Mod+L     { focus-column-right; }

	  Mod+Ctrl+H     { move-column-left; }
	  Mod+Ctrl+J     { move-window-down; }
	  Mod+Ctrl+K     { move-window-up; }
	  Mod+Ctrl+L     { move-column-right; }

	  Mod+Home { focus-column-first; }
	  Mod+End  { focus-column-last; }
	  Mod+Ctrl+Home { move-column-to-first; }
	  Mod+Ctrl+End  { move-column-to-last; }

	  Mod+Shift+H     { focus-monitor-left; }
	  Mod+Shift+J     { focus-monitor-down; }
	  Mod+Shift+K     { focus-monitor-up; }
	  Mod+Shift+L     { focus-monitor-right; }

	  Mod+Alt+Ctrl+H     { move-column-to-monitor-left; }
	  Mod+Alt+Ctrl+J     { move-column-to-monitor-down; }
	  Mod+Alt+Ctrl+K     { move-column-to-monitor-up; }
	  Mod+Alt+Ctrl+L     { move-column-to-monitor-right; }

	  Mod+U              { focus-workspace-down; }
	  Mod+I              { focus-workspace-up; }
	  Mod+Ctrl+U         { move-column-to-workspace-down; }
	  Mod+Ctrl+I         { move-column-to-workspace-up; }

	  Mod+Shift+U         { move-workspace-down; }
	  Mod+Shift+I         { move-workspace-up; }

	  Mod+1 { focus-workspace 1; }
	  Mod+2 { focus-workspace 2; }
	  Mod+3 { focus-workspace 3; }
	  Mod+4 { focus-workspace 4; }
	  Mod+5 { focus-workspace 5; }
	  Mod+6 { focus-workspace 6; }
	  Mod+7 { focus-workspace 7; }
	  Mod+8 { focus-workspace 8; }
	  Mod+9 { focus-workspace 9; }
	  Mod+Ctrl+1 { move-column-to-workspace 1; }
	  Mod+Ctrl+2 { move-column-to-workspace 2; }
	  Mod+Ctrl+3 { move-column-to-workspace 3; }
	  Mod+Ctrl+4 { move-column-to-workspace 4; }
	  Mod+Ctrl+5 { move-column-to-workspace 5; }
	  Mod+Ctrl+6 { move-column-to-workspace 6; }
	  Mod+Ctrl+7 { move-column-to-workspace 7; }
	  Mod+Ctrl+8 { move-column-to-workspace 8; }
	  Mod+Ctrl+9 { move-column-to-workspace 9; }

	  Mod+Tab { focus-workspace-previous; }

	  Mod+BracketLeft  { consume-or-expel-window-left; }
	  Mod+BracketRight { consume-or-expel-window-right; }

	  Mod+Comma  { consume-window-into-column; }
	  Mod+Period { expel-window-from-column; }

	  Mod+R { switch-preset-column-width; }
	  Mod+Shift+R { switch-preset-window-height; }
	  Mod+Ctrl+R { reset-window-height; }
	  Mod+M { maximize-column; }
	  Mod+F { fullscreen-window; }

	  Mod+Ctrl+F { expand-column-to-available-width; }
	  Mod+C { center-column; }
	  Mod+Ctrl+C { center-visible-columns; }

	  Mod+Minus { set-column-width "-10%"; }
	  Mod+Equal { set-column-width "+10%"; }
	  Mod+Shift+Minus { set-window-height "-10%"; }
	  Mod+Shift+Equal { set-window-height "+10%"; }

	  Mod+V       { toggle-window-floating; }
	  Mod+Shift+V { switch-focus-between-floating-and-tiling; }

	  Mod+Ctrl+t { toggle-column-tabbed-display; }

	  Mod+P { screenshot; }
	  Mod+Ctrl+P { screenshot-screen; }
	  Mod+Alt+P { screenshot-window; }

	  XF86Display { power-off-monitors; }
	  F7 { power-off-monitors; }
	  Mod+Ctrl+BackSpace { quit; }
  }
#+end_src

* WAYBAR
** CONFIG
#+begin_src json-ts :tangle ~/.config/waybar/config.jsonc
  {
    "layer": "top",
    "position": "left",
    "spacing": 12,
    "modules-left": [
      "custom/sensors",
      "cpu",
      "memory",
      "disk",
      "network",
      "systemd-failed-units",
    ],
    "modules-right": [
      "backlight",
      "pulseaudio",
      "battery",
      "idle_inhibitor",
      "tray",
      "clock",
      "custom/power"
    ],
    "custom/sensors": {
      "exec": "~/.config/waybar/scripts/sensors.sh",
      "interval": 10,
      "return-type": "json",
      "tooltip": true
    },
    "cpu": {
      "format": "{usage}%",
    },
    "memory": {
      "format": "{}%",
      "tooltip-format": "RAM: {used}GB/{total}GB\nSWAP: {swapUsed}GB/{swapTotal}GB",
    },
    "disk": {
      "format": "{percentage_used}%",
      "tooltip-format": "{used}/{total}"
    },
    "systemd-failed-units": {
      "format-ok": "",
      "format": "{nr_failed}",
      "tooltip-format": "System: {nr_failed_system}\nUser: {nr_failed_user}",
    },
    "network": {
      "format-wifi": "{signalStrength}%",
      "format-ethernet": "üåê",
      "format-linked": "üîó‚Äç",
      "format-disabled": "‚ö†Ô∏è",
      "format-disconnected": "üí•Ô∏è",
      "tooltip-format": "{ifname}\n{essid}\n{ipaddr}/{cidr}\nVia: {gwaddr}\nUpload: {bandwidthUpBytes}\nDownload: {bandwidthDownBytes}",
    },
    "backlight": {
      "format": "üîÜ",
      "tooltip-format": "{percent}%"
    },
    "pulseaudio": {
      "format": "üîä",
      "tooltip-format": "{volume}%",
      "format-muted": "üîá",
    },
    "battery": {
      "format": "",
      "full-at": 98,
      "states": {
	"good": 80,
	"warning": 30,
	"critical": 20
      },
      "tooltip-format": "{capacity}%\n{time}\n{cycles} cycles\n{health}% health",
      "format-full": "",
      "format-good": "üîã",
      "format-charging": "üîå",
      "format-discharging": "ü™´",
      "format-discharging-warning": "ü™´‚ùó",
      "format-discharging-critical": "{capacity}%‚ÄºÔ∏è",
    },
    "idle_inhibitor": {
      "format": "{icon}",
      "format-icons": {
	"activated": "‚òï",
	"deactivated": "ü•É"
      },
      "timeout": 120
    },
    "tray": {
      "spacing": 10,
    },
    "clock": {
      "format": "{:%H:%M\n%d/%m}",
      "tooltip-format": "<big>{:%Y %B}</big>\n<tt><small>{calendar}</small></tt>",
    },
    "custom/power": {
      "format" : "‚èª",
      "tooltip": false,
      "menu": "on-click",
      "menu-file": "$HOME/.config/waybar/power_menu.xml",
      "menu-actions": {
	"shutdown": "shutdown",
	"reboot": "reboot",
	"suspend": "systemctl suspend",
	"hibernate": "systemctl hibernate"
      }
    }
  }
#+end_src
** POWER
#+begin_src xml :tangle ~/.config/waybar/power_menu.xml
  <?xml version="1.0" encoding="UTF-8"?>
  <interface>
    <object class="GtkMenu" id="menu">
      <child>
	<object class="GtkMenuItem" id="suspend">
	<property name="label">Suspend</property>
	</object>
      </child>
      <child>
	<object class="GtkMenuItem" id="hibernate">
	<property name="label">Hibernate</property>
	</object>
      </child>
      <child>
	<object class="GtkMenuItem" id="shutdown">
	<property name="label">Shutdown</property>
	</object>
      </child>
      <child>
	<object class="GtkSeparatorMenuItem" id="delimiter1"/>
      </child>
      <child>
	<object class="GtkMenuItem" id="reboot">
	<property name="label">Reboot</property>
	</object>
      </child>
    </object>
  </interface>
#+end_src
** SCRIPTS
#+begin_src sh :tangle ~/.config/waybar/scripts/sensors.sh :tangle-mode o755
  #!/usr/bin/env bash
  output=$(sensors 2>/dev/null)
  temp=$(echo "$output" | awk '/Package id 0:/ {print $4; exit}')
  temp=${temp//+}
  temp=${temp%%.*}
  printf '{"text": "%s¬∞C", "tooltip": "%s"}\n' "$temp" "$(echo "$output" | sed ':a;N;$!ba;s/\n/\\n/g')"
#+end_src
** STYLE
#+begin_src css :tangle ~/.config/waybar/style.css
  ,* {
      font-family: FontAwesome, Roboto, Helvetica, Arial, sans-serif;
      font-size: 15px;
      font-weight: bold;
  }

  window#waybar {
      background-color: #000;
      color: #ffffff;
  }

  window#waybar.hidden {
      opacity: 1;
  }

  #network,
  #cpu,
  #memory,
  #disk,
  #temperature,
  #backlight,
  #pulseaudio,
  #battery,
  #idle_inhibitor,
  #tray,
  #clock {
      padding: 0 2px;
      color: #fff;
  }

  #network {
      background-color: #627;
      color: #FFF
  }

  #network.ethernet {
      background-color: #000;
      color: #FFF
  }

  #network.disconnected {
      background-color: #900;
  }

  #cpu {
      background-color: #B28;
      color: #FFF;
  }

  #memory {
      background-color: #627;
      color: #FFF;
  }

  #disk {
      background-color: #B28;
      color: #FFF;
  }

  #custom-sensors {
      background-color: #627;
      color: #FFF;
  }

  #backlight {
      background-color: #000;
  }

  #pulseaudio {
      background-color: #000;
  }

  #battery {
      background-color: #000;
      color: #FFF;
  }

  #battery.charging, #battery.plugged {
      background-color: #000;
      color: #FFF;
  }

  @keyframes blink {
      to {
	    background-color: #FF0;
	    color: #000;
      }
  }

  /* Using steps() instead of linear as a timing function to limit cpu usage */
  #battery.critical:not(.charging) {
      background-color: #900;
      color: #FFF;
      animation-name: blink;
      animation-duration: 0.5s;
      animation-timing-function: steps(12);
      animation-iteration-count: infinite;
      animation-direction: alternate;
  }

  #idle_inhibitor {
      background-color: #000;
  }

  #idle_inhibitor.activated {
      background-color: #000;
  }

  #tray {
      background-color: #000;
  }

  #tray > .passive {
      -gtk-icon-effect: dim;
  }

  #tray > .needs-attention {
      -gtk-icon-effect: highlight;
      background-color: #800;
  }

  #clock {
      background-color: #000000;
  }
#+end_src
